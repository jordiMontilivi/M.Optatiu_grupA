<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bombolles</title>
    <style>
        body {
            background-color: white;
            overflow: hidden;
        }

        .bombolla {
            background: radial-gradient(rgba(0,0,0,0),rgb(223, 80, 80));
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
        }
        .comptador {
            position: absolute;
            top: 10px;
            left: 120px;
            font-size: 16px;
            color: black;
        }

        .comptadorExplotades {
            position: absolute;
            top: 10px;
            left: 230px;
            font-size: 16px;
            color: black;
        }
    </style>
</head>

<body>
    <script>
        // Creem el so
        pop = new Audio("media/pop.mp3")

        // Creem el botó
        boto = document.createElement("button")
        boto.innerHTML = "Nova bombolla"
        boto.onclick = creaBombolla
        document.body.appendChild(boto)

        // comptadors de bombolles
        let comptadorBombolles = 0  // Variable global per a guardar comptador de bombolles
        let comptadorBombollesExplotades = 0  // Variable global per a guardar comptador de bombolles explotades

        // Creem un div per a colocar un comptador de bombolles
        comptador = document.createElement("div")
        comptador.classList.add("comptador")
        comptador.innerHTML = "Bombolles: " + comptadorBombolles
        document.body.appendChild(comptador)

        // Creem un div per a colocar un comptador de bombolles explotades
        comptadorExplotades = document.createElement("div")
        comptadorExplotades.classList.add("comptadorExplotades")
        comptadorExplotades.innerHTML = "Bombolles explotades: " + comptadorBombollesExplotades
        document.body.appendChild(comptadorExplotades)
       
       
        // Funció que crea una bombolla individual
        function creaBombolla() {
            // Triem aleatòriament la mida, posició i transparència de la bombolla
            var m = Math.floor(Math.random() * 200) + 50
            var x = Math.floor(Math.random() * (window.innerWidth - m))
            var y = window.innerHeight
            // Transparència = valor aletori entre 0.5 i 1.0 amb només 2 decimals
            var t = Math.floor(((Math.random() * 0.5) + 0.5) * 100) / 100

            // Creem un div perquè sigui la nova bombolla
            var bombolla = document.createElement("div")

            // Li apliquem una classe i atributs CSS
            bombolla.classList.add("bombolla")
            bombolla.style.left = `${x}px`
            bombolla.style.top = `${y}px`
            bombolla.style.width = `${m}px`
            bombolla.style.height = `${m}px`
            bombolla.style.opacity = `${t}`

            // Associem l'esdeveniment onclick per poder fer explotar la bombolla
            bombolla.onclick = function () {
                // Quan fem clic, eliminarem l'objecte del DOM i s'esborrarà automàticament
                this.remove()
                // So d'explotar la bombolla
                pop.play()
                // Actualitzem el comptador de bombolles explotades
                comptadorBombollesExplotades++;
                actualitzacomptadorExplotades(comptadorBombollesExplotades);
            }

            // Afegim la bombolla acabada de crear al DOM com a filla de l'objecte body
            document.body.appendChild(bombolla)

            // Actualitzem el comptador de bombolles
            comptadorBombolles++;
            actualitzacomptador(comptadorBombolles);
        }

        // Funció que actualitza el comptador de bombolles
        function actualitzacomptador(puntuacio) {
            comptador.innerHTML = "Bombolles: " + puntuacio;
        }

        // Funció que actualitza el comptador de bombolles explotades
        function actualitzacomptadorExplotades(puntuacio) {
            comptadorExplotades.innerHTML = "Bombolles explotades: " + puntuacio;
        }

        // Temporitzador per moure les bombolles
        function actualitza() {
            // Busquem tots els elements del DOM de la classe "bombolla"
            llistaBombolles = document.getElementsByClassName("bombolla")

            // Recorrem tots els elements
            for (bombolla of llistaBombolles) {
                // Guardem la coordenada Y i la mida
                var top = parseInt(bombolla.style.top)
                var height = parseInt(bombolla.style.height)

                // Si la bombolla ha desaparegut per la part de dalt de la pantalla
                if (top <= -height) {
                    bombolla.remove()                    
                }
                else {
                    // Altrament fem que la bombolla vagi pujant per la pantalla
                    bombolla.style.top = Math.floor(top - (height / 100)) + "px"
                }
            }

            // De tant en tant fem aparèixer alguna bombolla aleatòriament
            if (Math.random() * 1000 >= 990) creaBombolla()

            // Preparar següent redibuixat de pantalla
            requestAnimationFrame(actualitza)
        }

        // Iniciar animació
        actualitza()
    </script>
</body>

</html>